//!
//! \file       adc.h
//! \author     Abdelrahman Ali
//! \date       2024-01-24
//!
//! \brief      adc pio.
//!

#ifndef ADC_H
#define ADC_H

//---------------------------------------------------------------------------
// INCLUDES
//---------------------------------------------------------------------------

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "pico/stdlib.h"
#include "hardware/pio.h"
#include "hardware/dma.h"
#include "hardware/gpio.h"
#include "hardware/clocks.h"

//---------------------------------------------------------------------------
// CONSTANTS
//---------------------------------------------------------------------------

#define PIN_BASE 0
#define SAMPLE_COUNT 8000
#define ADC_CLK 120000000
#define PULSE_CLK 125000000
#define GPIO11 11
#define GPIO16 16

#define DMA_TIMEOUT_MS 3000

//---------------------------------------------------------------------------
// ADC INIT FUNCTION
//---------------------------------------------------------------------------
void pio_adc_init();

//---------------------------------------------------------------------------
// ADC DMA FUNCTION
//---------------------------------------------------------------------------
void pio_adc_dma();

//---------------------------------------------------------------------------
// ADC CLEAN FIFO FUNCTION
//---------------------------------------------------------------------------
void pio_adc_clear_fifo();

//---------------------------------------------------------------------------
// PULSE ADC DMA TIMEOUT
//---------------------------------------------------------------------------
bool dma_wait_timeout(uint chan, uint32_t ms);

//---------------------------------------------------------------------------
// PULSE ADC RESTART SMs
//---------------------------------------------------------------------------
void reset_all_sms();

//---------------------------------------------------------------------------
// PULSE ADC TRIGGER FUNCTION
//---------------------------------------------------------------------------
void pulse_adc_trigger(const char *data);

//---------------------------------------------------------------------------
// ADC MAIN FUNCTION
//---------------------------------------------------------------------------
void adc(const char *data);

//---------------------------------------------------------------------------
// END OF FILE
//---------------------------------------------------------------------------

#endif
